<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="google" value="notranslate" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <link rel="stylesheet" th:href="@{/css/allCss.css}" />
    <link rel="stylesheet" th:href="@{/css/boardDetail.css}">
    <link rel="stylesheet" th:href="@{/css/hamburger.css}" />
    <link rel="icon" href="/img/realLogo.png">
    <link rel="stylesheet" type="text/css"
          th:href="@{https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css}" />
    <title>ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€</title>
</head>

<body>
<div class="wrapper">
    <div class="welcome">
        <p th:text="${session.memberNick} + 'ë‹˜, Mini Game Worldì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.ğŸ±â€ğŸ‰'"></p>
    </div>
    <div class="header">
        <nav role="navigation">
            <div id="menuToggle">
                <!-- í–„ë²„ê±° ëª¨ì–‘ -->
                <input type="checkbox" />
                <div class="burger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>

                <ul id="menu">
                    <a th:href="@{/main}">
                        <li>Home</li>
                    </a>
                    <a th:href="@{/boardList}">
                        <li>Community</li>
                    </a>
                    <a th:href="@{/myPage}">
                        <li>My Page</li>
                    </a>
                    <a th:href="@{/QnAPage}">
                        <li>Q&A</li>
                    </a>
                    <a th:href="@{/aboutUs}">
                        <li>About Us</li>
                    </a>
                </ul>
            </div>
        </nav>
        <div class="logo">
            <a th:href="@{/main}"><img class="logoImg" th:src="@{/img/logo.png}" alt=""></a>
        </div>
        <div class="top-nav">
            <ul class="top-nav-ul">
                <li class="top-nav-li"><a th:href="@{/main}">Home</a></li>
                <li class="top-nav-li"><a th:href="@{/boardList}">Community</a></li>
                <li class="top-nav-li"><a th:href="@{/myPage}">My Page</a></li>
                <li class="top-nav-li"><a th:href="@{/QnAPage}">Q&A</a></li>
                <li class="top-nav-li"><a th:href="@{/aboutUs}">About Us</a></li>
                <li class="drop-top-nav-li"><a href="#">Account</a>
                    <ul class="drop-ul">
                        <li><a th:href="@{/logout}" onclick="logout(event)">logout</a></li>
                        <li><a href="#"><img class="imgicon" src="/img/ì„¤ì •.png">ì„¤ì •</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div> <!-- header ë -->

    <div class="board-content-section">

        <div id="board-list">
            <div class="container">
                <table class="board-table">
                    <thead>
                    <tr style="overflow: hidden;">
                        <th scope="col" colspan="3" style="font-size: 2em; width: 82%; box-sizing: border-box;"
                            th:text="${board.boardTitle}"></th>
                        <th th:if="${session.memberNick == board.getMemberNick()}" style="padding: 0; width: 18%; box-sizing: border-box;">
                            <button class="btn btn--stripe" type="button" th:onclick="|location.href='/boardUpdateForm?board_idx=${board.board_idx}'|"
                                    style="display: inline; margin: 5% 3% 5%; width: 42%; padding: 12px;">ìˆ˜ì •</button>
                            <button class="btn btn--stripe" type="button" th:onclick="|location.href='/boardDelete?board_idx=${board.board_idx}'|"
                                    style="display: inline; margin: 5% 3% 5%; width: 42%; padding: 12px;">ì‚­ì œ</button>
                        <input th:type="text" th:value="${board.board_idx}" th:hidden="hidden"/>
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr class="board-Writer">
                        <td class="writer-photo" rowspan="2">ì‚¬ì§„ì¹¸</td>
                        <td colspan="2" style="text-align: left; padding-left: 10px;" th:text="${board.memberNick}"></td>
                        <td style="text-align: right; padding-right: 10px;" th:text="${board.CREATED_AT}"></td>
                    </tr>
                    <tr>
                        <td style="text-align: left; padding-left: 10px; width: 8%;">ì¡°íšŒìˆ˜</td>
                        <td colspan="2" style="text-align: right; padding-right: 10px;" th:text="${board.boardCount}"></td>
<!--                        <td colspan="2" style="text-align: left; padding-left: 10px;" th:text="${views}"></td>-->
                    </tr>
                    <tr>
                        <td colspan="4" style="word-break: break-all" th:text="${board.boardText}"></td>
                    </tr>
                    </tbody>
                </table>

                <!-- ëŒ“ê¸€        -->
                <div class="comment-section">
                    <h2>ëŒ“ê¸€</h2>
                    <div class="comment-list">
                        <!-- ëŒ“ê¸€ ëª©ë¡ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë  ë¶€ë¶„ -->
                        <div th:each="comment : ${comments}" class="comment-item" th:data-comment-id="${comment.getCommentId()}">
                            <div class="comment-header">
                                <span class="comment-nick" th:text="${comment.getCommentNick()}"></span>
                                <div class="comment-content-wrapper">
                                    <span class="comment-content" th:text="${comment.getCommentText()}"></span>
                                </div>
                                <div style="justify-content:flex-end;" >
                                    <button th:if="${session.memberNick == comment.getCommentNick()}" class="comment-delete-btn" type="button"  th:onclick="deleteComment(${comment.getCommentId()})">x</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <form class="comment-form">
                        <div class="comment-input-container">
                            <input type="text" class="comment-nick" th:value="${session.memberNick}" th:readonly="readonly" />
                            <textarea class="comment-input" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." required></textarea>
                        </div>
                        <input type="hidden" name="boardNum" th:value="${board.board_idx}" />
                        <button type="submit" class="btn btn--stripe" style="width: 100px;margin: 0 0 0 5px">ë“±ë¡</button>
                    </form>
                </div>

                <div class="btn-box">
                    <a class="btn btn--stripe" th:if="${prevBoard != null}" th:href="@{/boardDetail(board_idx=${prevBoard.board_idx})}">â—€ ì´ì „ ê¸€</a>
                    <a class="btn btn--stripe" th:href="@{/boardList}">ì „ì²´ ëª©ë¡ ë³´ê¸°</a><a class="btn btn--stripe" th:href="@{/myPage}">ë‚´ê°€ ì“´ ëª©ë¡ ë³´ê¸°</a>
                    <a class="btn btn--stripe" th:if="${nextBoard != null}" th:href="@{/boardDetail(board_idx=${nextBoard.board_idx})}">ë‹¤ìŒ ê¸€ â–¶</a>

                </div>
            </div>
        </div>

        <!-- í˜ì´ì§•.. -->


    </div> <!-- board-content-section ë -->

    <!-- footer -->
    <div class="footer">
        <div class="company-info">
            ê·¸ë¦° ì»´í“¨í„° <br>
            ê¹€ê·¸ë¦° (Team2EmailService@gmail.com) <br>
            ê³ ê°ì„¼í„° : AM 10: 00 ~ PM6 : 00
            Copyright 2023. 2íŒ€ <br>
            All rights reserved.
        </div>
        <div class="footer-text hidden-info">
            <p>íšŒì‚¬ì •ë³´ <br>
                ìƒí˜¸ : ê·¸ë¦° ì»´í“¨í„° <br>
                ì£¼ì†Œ : ê²½ê¸°ë„ ìˆ˜ì›ì‹œ <br>
                ê°œì¸ì •ë³´ê´€ë¦¬ ì±…ì„ì : ê¹€ê·¸ë¦° (Team2EmailService@gmail.com) <br>
                ì‚¬ì—…ì ë“±ë¡ë²ˆí˜¸ : 111-11-1111
            </p>
            <p>
                íšŒì‚¬ì†Œê°œ | ì‡¼í•‘ê°€ì´ë“œ | ê°œì¸ì •ë³´ë³´í˜¸ì •ì±… | ì´ìš©ì•½ê´€
            </p>
        </div>
        <div class="footers hidden-info">
            <div class="footer-cs">
                <p>
                    ê·¼ë¬´ì‹œê°„ : ì›” ~ ê¸ˆ AM 9:00 ~ PM 7:00 <br>
                    ì ì‹¬ì‹œê°„ : PM12 :00 ~ PM 1 : 00 <br>
                    ê³ ê°ì„¼í„° : AM 10: 00 ~ PM6 : 00
                </p>
            </div>
            <div class="ours">
                <p>ëª¨ë“  ì €ì‘ê¶Œì€ 2íŒ€ì—ê²Œ ìˆìŠµë‹ˆë‹¤. <br>
                    Copyright 2023. 2íŒ€ <br>
                    All rights reserved.
                </p>
            </div>
        </div>
    </div> <!-- footer ë -->
</div> <!-- wrapperì˜ ë -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    //     ë¡œê·¸ì•„ì›ƒ
    function logout(event) {
        event.preventDefault(); // ê¸°ë³¸ ë™ì‘ ë°©ì§€

        const confirmed = confirm("ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
        if (confirmed) {
            // ì„œë²„ë¡œ ë¡œê·¸ì•„ì›ƒ ìš”ì²­ì„ ë³´ë‚´ëŠ” Ajax ìš”ì²­ ë“±ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            // ì„¸ì…˜ì„ ì‚­ì œí•˜ëŠ” ì‘ì—…ì€ ì„œë²„ ì¸¡ì—ì„œ ì²˜ë¦¬ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

            // ì„¸ì…˜ ì‚­ì œ í›„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = "/logout";
        }
    }

    // ëŒ“ê¸€ ì €ì¥
    function saveComment(commentText, boardNum, commentNick) {
        var comment = {
            commentText: commentText,
            boardNum: boardNum,
            commentNick: commentNick
        };

        $.ajax({
            type: 'POST',
            url: '/saveComment',
            contentType: 'application/json',
            data: JSON.stringify(comment),
            success: function(response) {
                // ì„œë²„ë¡œë¶€í„° ì‘ë‹µì„ ë°›ìœ¼ë©´ ìƒˆë¡œìš´ ëŒ“ê¸€ì„ ë™ì ìœ¼ë¡œ ì¶”ê°€
                const newComment = document.createElement('div');
                newComment.classList.add('comment-item');
                newComment.innerHTML = `
                    <div class="comment-header">
                        <span class="comment-nick">${response.commentNick}</span>
                    </div>
                    <div class="comment-content">${response.commentText}</div>
                `;

                const commentList = document.querySelector('.comment-list');
                commentList.appendChild(newComment);

                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                const commentInput = document.querySelector('.comment-input');
                commentInput.value = '';

                // í™”ë©´ ìƒˆë¡œê³ ì¹¨
                location.reload();
            },
            error: function(xhr, status, error) {
                console.log(xhr.responseText);
            }
        });
    }

    // ëŒ“ê¸€ ë“±ë¡ í¼ ì œì¶œ ì²˜ë¦¬
    $('.comment-form').submit(function(e) {
        e.preventDefault(); // ê¸°ë³¸ ë™ì‘ ë°©ì§€

        var commentInput = $('.comment-input');
        var commentText = commentInput.val();
        var boardNum = $('input[name="boardNum"]').val();
        var commentNick = $('input[name="commentNick"]').val();

        if (commentText.trim() !== '') {
            saveComment(commentText, boardNum, commentNick);
        }

        return false;
    });

    // ëŒ“ê¸€ ì‚­ì œ
    function deleteComment(commentId) {
        $.ajax({
            type: 'POST',
            url: '/deleteComment/' + commentId,
            contentType: 'application/json',
            data: JSON.stringify({ "commentId": commentId }),
            success: function(response) {
                // ì‚­ì œê°€ ì™„ë£Œë˜ë©´ í™”ë©´ì—ì„œ í•´ë‹¹ ëŒ“ê¸€ ì œê±°
                const commentItem = document.querySelector(`.comment-item[data-comment-id="${commentId}"]`);
                if (commentItem) {
                    commentItem.remove();
                }
            },
            error: function(xhr, status, error) {
                console.log(xhr.responseText);
            }
        });
    }

    // ëŒ“ê¸€ ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
    $('.comment-list').on('click', '.comment-delete-btn', function() {
        const commentId = $(this).closest('.comment-item').data('comment-id');
        deleteComment(commentId);
    });

</script>
</body>

</html>